From 2f1a91b60aead0a0a7663c88dc1085a50fa916c7 Mon Sep 17 00:00:00 2001
From: Anay Wadhera <awadhera@berkeley.edu>
Date: Fri, 3 Apr 2020 11:59:59 -0700
Subject: [PATCH] angler: relabel sys.listeners.registered

Change-Id: I76e7f8ee59177bb25619c2dea17d32ab6a8e7e9d
---
 sepolicy/vendor/hal_keymaster_default.te | 1 +
 sepolicy/vendor/init-qseecomd-sh.te      | 1 +
 sepolicy/vendor/property.te              | 1 +
 sepolicy/vendor/property_contexts        | 1 +
 sepolicy/vendor/tee.te                   | 2 +-
 sepolicy/vendor/vold.te                  | 2 ++
 6 files changed, 7 insertions(+), 1 deletion(-)
 create mode 100644 sepolicy/vendor/hal_keymaster_default.te

diff --git a/sepolicy/vendor/hal_keymaster_default.te b/sepolicy/vendor/hal_keymaster_default.te
new file mode 100644
index 0000000..96936e2
--- /dev/null
+++ b/sepolicy/vendor/hal_keymaster_default.te
@@ -0,0 +1 @@
+get_prop(hal_keymaster_default, vendor_tee_listener_prop)
diff --git a/sepolicy/vendor/init-qseecomd-sh.te b/sepolicy/vendor/init-qseecomd-sh.te
index 967f124..f4d19cc 100644
--- a/sepolicy/vendor/init-qseecomd-sh.te
+++ b/sepolicy/vendor/init-qseecomd-sh.te
@@ -10,3 +10,4 @@ allow init-angler-qseecomd-sh vendor_toolbox_exec:file rx_file_perms;
 
 allow init-angler-qseecomd-sh vendor_file:dir read;
 
+get_prop(init-angler-qseecomd-sh, vendor_tee_listener_prop)
diff --git a/sepolicy/vendor/property.te b/sepolicy/vendor/property.te
index 4b63eae..f599702 100644
--- a/sepolicy/vendor/property.te
+++ b/sepolicy/vendor/property.te
@@ -3,3 +3,4 @@ type ctl_ppd_prop, property_type;
 type qcom_ims_prop, property_type;
 type radio_atfwd_prop, property_type;
 type vendor_device_prop, property_type;
+type vendor_tee_listener_prop, property_type;
diff --git a/sepolicy/vendor/property_contexts b/sepolicy/vendor/property_contexts
index 8c92c70..a1b9e6d 100644
--- a/sepolicy/vendor/property_contexts
+++ b/sepolicy/vendor/property_contexts
@@ -4,3 +4,4 @@ sensors.contexthub.  u:object_r:contexthub_prop:s0
 sys.ims.             u:object_r:qcom_ims_prop:s0
 net.r_rmnet          u:object_r:net_radio_prop:s0
 vendor.qcom.devup    u:object_r:vendor_device_prop:s0
+sys.listeners.registered u:object_r:vendor_tee_listener_prop:s0
diff --git a/sepolicy/vendor/tee.te b/sepolicy/vendor/tee.te
index 2bdb4f3..5b7b858 100644
--- a/sepolicy/vendor/tee.te
+++ b/sepolicy/vendor/tee.te
@@ -13,7 +13,7 @@ allow tee fingerprintd_data_file:file rw_file_perms;
 allow tee fingerprintd_data_file:dir r_dir_perms;
 
 # Set the sys.listeners.registered property
-set_prop(tee, system_prop)
+set_prop(tee, vendor_tee_listener_prop)
 
 allow tee time:unix_stream_socket connectto;
 
diff --git a/sepolicy/vendor/vold.te b/sepolicy/vendor/vold.te
index 34bb5f1..85d98ae 100644
--- a/sepolicy/vendor/vold.te
+++ b/sepolicy/vendor/vold.te
@@ -1,2 +1,4 @@
 # generated by proc scan, unnecessary
 dontaudit vold proc_irq:dir read;
+
+get_prop(vold, vendor_tee_listener_prop)
